{"apiVersion":"v1","kind":"Pod","metadata":{"annotations":{"kubernetes.io/limit-ranger":"LimitRanger plugin set: cpu, memory request for init container sysctl-init; cpu, memory limit for init container sysctl-init; cpu, memory request for init container plugins-install; cpu, memory limit for init container plugins-install","kubernetes.io/psp":"eks.privileged"},"creationTimestamp":"2021-12-19T10:19:33Z","generateName":"es-svc-master-","labels":{"app":"es-svc-master","controller-revision-hash":"es-svc-master-8b95996b6","logging.opstreelabs.in":"true","logging.opstreelabs.in/kind":"Elasticsearch","role":"master","statefulset.kubernetes.io/pod-name":"es-svc-master-0"},"name":"es-svc-master-0","namespace":"staging","ownerReferences":[{"apiVersion":"apps/v1","blockOwnerDeletion":true,"controller":true,"kind":"StatefulSet","name":"es-svc-master","uid":"82b8b72c-c622-4893-aef8-b3ca14133845"}],"resourceVersion":"236679261","selfLink":"/api/v1/namespaces/staging/pods/es-svc-master-0","uid":"de375756-d944-4712-acf4-2a30eed89fc1"},"spec":{"affinity":{"podAntiAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":[{"labelSelector":{"matchExpressions":[{"key":"app","operator":"In","values":["elasticsearch-cluster-master"]}]},"topologyKey":"kubernetes.io/hostname"}]}},"containers":[{"env":[{"name":"ES_JAVA_OPTS","value":"-Xmx1g -Xms1g"},{"name":"SCHEME","value":"http"},{"name":"cluster.initial_master_nodes","value":"es-svc-master-1,es-svc-master-2,es-svc-master-3,"},{"name":"cluster.name","value":"dev"},{"name":"discovery.seed_hosts","value":"es-svc-master-headless"},{"name":"network.host","value":"0.0.0.0"},{"name":"node.data","value":"false"},{"name":"node.ingest","value":"false"},{"name":"node.master","value":"true"},{"name":"node.name","valueFrom":{"fieldRef":{"apiVersion":"v1","fieldPath":"metadata.name"}}}],"image":"docker.elastic.co/elasticsearch/elasticsearch:7.9.1","imagePullPolicy":"IfNotPresent","name":"elastic","readinessProbe":{"exec":{"command":["sh","-c","#!/usr/bin/env bash -e\nSTART_FILE=/tmp/.es_start_file\n\nhttp () {\n  local path=\"${1}\"\n  local args=\"${2}\"\n  set -- -XGET -s\n\n  if [ \"$args\" != \"\" ]; then\n    set -- \"$@\" $args\n  fi\n\n  if [ -n \"${ELASTIC_USERNAME}\" ] \u0026\u0026 [ -n \"${ELASTIC_PASSWORD}\" ]; then\n    set -- \"$@\" -u \"${ELASTIC_USERNAME}:${ELASTIC_PASSWORD}\"\n  fi\n\n  curl --output /dev/null -k \"$@\" \"${SCHEME}://127.0.0.1:9200${path}\"\n}\n\nif [ -f \"${START_FILE}\" ]; then\n  echo 'Elasticsearch is already running, lets check the node is healthy'\n  HTTP_CODE=$(http \"/\" \"-w %{http_code}\")\n  RC=$?\n  if [[ ${RC} -ne 0 ]]; then\n    echo \"curl --output /dev/null -k -XGET -s -w '%{http_code}' \\${BASIC_AUTH} ${SCHEME}://127.0.0.1:9200/ failed with RC ${RC}\"\n    exit ${RC}\n  fi\n  # ready if HTTP code 200, 503 is tolerable if ES version is 6.x\n  if [[ ${HTTP_CODE} == \"200\" ]]; then\n    exit 0\n  elif [[ ${HTTP_CODE} == \"503\" \u0026\u0026 \"7\" == \"6\" ]]; then\n    exit 0\n  else\n    echo \"curl --output /dev/null -k -XGET -s -w '%{http_code}' \\${BASIC_AUTH} ${SCHEME}://127.0.0.1:9200/ failed with HTTP code ${HTTP_CODE}\"\n    exit 1\n  fi\n\nelse\n  echo 'Waiting for elasticsearch cluster to become ready (request params: \"wait_for_status=green\u0026timeout=1s\" )'\n  if http \"/_cluster/health?wait_for_status=green\u0026timeout=1s\" \"--fail\" ; then\n    touch ${START_FILE}\n    exit 0\n  else\n    echo 'Cluster is not yet ready (request params: \"wait_for_status=green\u0026timeout=1s\" )'\n    exit 1\n  fi\nfi\n"]},"failureThreshold":3,"initialDelaySeconds":10,"periodSeconds":10,"successThreshold":3,"timeoutSeconds":5},"resources":{"limits":{"cpu":"500m","memory":"2Gi"},"requests":{"cpu":"500m","memory":"2Gi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/usr/share/elasticsearch/data","name":"es-svc-master"},{"mountPath":"/usr/share/elasticsearch/plugins","name":"plugin-volume"},{"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount","name":"default-token-bcrnx","readOnly":true}]}],"dnsPolicy":"ClusterFirst","enableServiceLinks":true,"hostname":"es-svc-master-0","initContainers":[{"command":["sysctl","-w","vm.max_map_count=262144"],"image":"docker.elastic.co/elasticsearch/elasticsearch:7.9.1","imagePullPolicy":"IfNotPresent","name":"sysctl-init","resources":{"limits":{"cpu":"1","memory":"512Mi"},"requests":{"cpu":"100m","memory":"512Mi"}},"securityContext":{"privileged":true,"runAsUser":0},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount","name":"default-token-bcrnx","readOnly":true}]},{"command":["sh","-c","bin/elasticsearch-plugin install --batch repository-s3"],"image":"docker.elastic.co/elasticsearch/elasticsearch:7.9.1","imagePullPolicy":"IfNotPresent","name":"plugins-install","resources":{"limits":{"cpu":"1","memory":"512Mi"},"requests":{"cpu":"100m","memory":"512Mi"}},"securityContext":{"privileged":true,"runAsUser":0},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/usr/share/elasticsearch/plugins","name":"plugin-volume"},{"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount","name":"default-token-bcrnx","readOnly":true}]}],"nodeName":"ip-172-31-0-215.ap-south-1.compute.internal","priority":0,"restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{"fsGroup":1000,"runAsUser":1000},"serviceAccount":"default","serviceAccountName":"default","subdomain":"es-svc-master-headless","terminationGracePeriodSeconds":30,"tolerations":[{"effect":"NoExecute","key":"node.kubernetes.io/not-ready","operator":"Exists","tolerationSeconds":300},{"effect":"NoExecute","key":"node.kubernetes.io/unreachable","operator":"Exists","tolerationSeconds":300}],"volumes":[{"name":"es-svc-master","persistentVolumeClaim":{"claimName":"es-svc-master-es-svc-master-0"}},{"emptyDir":{},"name":"plugin-volume"},{"name":"default-token-bcrnx","secret":{"defaultMode":420,"secretName":"default-token-bcrnx"}}]},"status":{"conditions":[{"lastProbeTime":null,"lastTransitionTime":"2021-12-19T10:19:54Z","status":"True","type":"Initialized"},{"lastProbeTime":null,"lastTransitionTime":"2021-12-19T10:21:51Z","status":"True","type":"Ready"},{"lastProbeTime":null,"lastTransitionTime":"2021-12-19T10:21:51Z","status":"True","type":"ContainersReady"},{"lastProbeTime":null,"lastTransitionTime":"2021-12-19T10:19:33Z","status":"True","type":"PodScheduled"}],"containerStatuses":[{"containerID":"docker://fcfa7f6dfa8a80e68fbd8316346fc700a43ad398b109b3a85c86362baa9b8eb9","image":"docker.elastic.co/elasticsearch/elasticsearch:7.9.1","imageID":"docker-pullable://docker.elastic.co/elasticsearch/elasticsearch@sha256:0a5308431aee029636858a6efe07e409fa699b02549a78d7904eb931b8c46920","lastState":{},"name":"elastic","ready":true,"restartCount":0,"started":true,"state":{"running":{"startedAt":"2021-12-19T10:19:54Z"}}}],"hostIP":"172.31.0.215","initContainerStatuses":[{"containerID":"docker://e7342967215961df75c291ca0b72ff45f2ec12aa76929a59b372039a773afd02","image":"docker.elastic.co/elasticsearch/elasticsearch:7.9.1","imageID":"docker-pullable://docker.elastic.co/elasticsearch/elasticsearch@sha256:0a5308431aee029636858a6efe07e409fa699b02549a78d7904eb931b8c46920","lastState":{},"name":"sysctl-init","ready":true,"restartCount":0,"state":{"terminated":{"containerID":"docker://e7342967215961df75c291ca0b72ff45f2ec12aa76929a59b372039a773afd02","exitCode":0,"finishedAt":"2021-12-19T10:19:39Z","reason":"Completed","startedAt":"2021-12-19T10:19:39Z"}}},{"containerID":"docker://a0d35a5c74c878ecf18cf027cdb142e4abb89d2afd648a0041f04f097e108959","image":"docker.elastic.co/elasticsearch/elasticsearch:7.9.1","imageID":"docker-pullable://docker.elastic.co/elasticsearch/elasticsearch@sha256:0a5308431aee029636858a6efe07e409fa699b02549a78d7904eb931b8c46920","lastState":{},"name":"plugins-install","ready":true,"restartCount":0,"state":{"terminated":{"containerID":"docker://a0d35a5c74c878ecf18cf027cdb142e4abb89d2afd648a0041f04f097e108959","exitCode":0,"finishedAt":"2021-12-19T10:19:54Z","reason":"Completed","startedAt":"2021-12-19T10:19:40Z"}}}],"phase":"Running","podIP":"172.31.1.120","podIPs":[{"ip":"172.31.1.120"}],"qosClass":"Burstable","startTime":"2021-12-19T10:19:33Z"}}