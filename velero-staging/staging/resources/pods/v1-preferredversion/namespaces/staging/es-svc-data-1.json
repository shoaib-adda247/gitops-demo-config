{"apiVersion":"v1","kind":"Pod","metadata":{"annotations":{"kubernetes.io/limit-ranger":"LimitRanger plugin set: cpu, memory request for init container sysctl-init; cpu, memory limit for init container sysctl-init; cpu, memory request for init container plugins-install; cpu, memory limit for init container plugins-install","kubernetes.io/psp":"eks.privileged"},"creationTimestamp":"2021-12-19T10:16:20Z","generateName":"es-svc-data-","labels":{"app":"es-svc-data","controller-revision-hash":"es-svc-data-869d9dbb56","logging.opstreelabs.in":"true","logging.opstreelabs.in/kind":"Elasticsearch","role":"data","statefulset.kubernetes.io/pod-name":"es-svc-data-1"},"name":"es-svc-data-1","namespace":"staging","ownerReferences":[{"apiVersion":"apps/v1","blockOwnerDeletion":true,"controller":true,"kind":"StatefulSet","name":"es-svc-data","uid":"6477bc54-78be-45e7-b521-d7077ef43b12"}],"resourceVersion":"236678361","selfLink":"/api/v1/namespaces/staging/pods/es-svc-data-1","uid":"90640c71-3636-445c-9e6f-1b19fe969e34"},"spec":{"affinity":{"podAntiAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":[{"labelSelector":{"matchExpressions":[{"key":"app","operator":"In","values":["elasticsearch-cluster-data"]}]},"topologyKey":"kubernetes.io/hostname"}]}},"containers":[{"env":[{"name":"ES_JAVA_OPTS","value":"-Xmx1g -Xms1g"},{"name":"SCHEME","value":"http"},{"name":"cluster.name","value":"dev"},{"name":"discovery.seed_hosts","value":"es-svc-master-headless"},{"name":"network.host","value":"0.0.0.0"},{"name":"node.data","value":"true"},{"name":"node.ingest","value":"false"},{"name":"node.master","value":"false"},{"name":"node.name","valueFrom":{"fieldRef":{"apiVersion":"v1","fieldPath":"metadata.name"}}}],"image":"docker.elastic.co/elasticsearch/elasticsearch:7.9.1","imagePullPolicy":"IfNotPresent","name":"elastic","readinessProbe":{"exec":{"command":["sh","-c","#!/usr/bin/env bash -e\nSTART_FILE=/tmp/.es_start_file\n\nhttp () {\n  local path=\"${1}\"\n  local args=\"${2}\"\n  set -- -XGET -s\n\n  if [ \"$args\" != \"\" ]; then\n    set -- \"$@\" $args\n  fi\n\n  if [ -n \"${ELASTIC_USERNAME}\" ] \u0026\u0026 [ -n \"${ELASTIC_PASSWORD}\" ]; then\n    set -- \"$@\" -u \"${ELASTIC_USERNAME}:${ELASTIC_PASSWORD}\"\n  fi\n\n  curl --output /dev/null -k \"$@\" \"${SCHEME}://127.0.0.1:9200${path}\"\n}\n\nif [ -f \"${START_FILE}\" ]; then\n  echo 'Elasticsearch is already running, lets check the node is healthy'\n  HTTP_CODE=$(http \"/\" \"-w %{http_code}\")\n  RC=$?\n  if [[ ${RC} -ne 0 ]]; then\n    echo \"curl --output /dev/null -k -XGET -s -w '%{http_code}' \\${BASIC_AUTH} ${SCHEME}://127.0.0.1:9200/ failed with RC ${RC}\"\n    exit ${RC}\n  fi\n  # ready if HTTP code 200, 503 is tolerable if ES version is 6.x\n  if [[ ${HTTP_CODE} == \"200\" ]]; then\n    exit 0\n  elif [[ ${HTTP_CODE} == \"503\" \u0026\u0026 \"7\" == \"6\" ]]; then\n    exit 0\n  else\n    echo \"curl --output /dev/null -k -XGET -s -w '%{http_code}' \\${BASIC_AUTH} ${SCHEME}://127.0.0.1:9200/ failed with HTTP code ${HTTP_CODE}\"\n    exit 1\n  fi\n\nelse\n  echo 'Waiting for elasticsearch cluster to become ready (request params: \"wait_for_status=green\u0026timeout=1s\" )'\n  if http \"/_cluster/health?wait_for_status=green\u0026timeout=1s\" \"--fail\" ; then\n    touch ${START_FILE}\n    exit 0\n  else\n    echo 'Cluster is not yet ready (request params: \"wait_for_status=green\u0026timeout=1s\" )'\n    exit 1\n  fi\nfi\n"]},"failureThreshold":3,"initialDelaySeconds":10,"periodSeconds":10,"successThreshold":3,"timeoutSeconds":5},"resources":{"limits":{"cpu":"500m","memory":"2Gi"},"requests":{"cpu":"500m","memory":"2Gi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/usr/share/elasticsearch/data","name":"es-svc-data"},{"mountPath":"/usr/share/elasticsearch/plugins","name":"plugin-volume"},{"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount","name":"default-token-bcrnx","readOnly":true}]}],"dnsPolicy":"ClusterFirst","enableServiceLinks":true,"hostname":"es-svc-data-1","initContainers":[{"command":["sysctl","-w","vm.max_map_count=262144"],"image":"docker.elastic.co/elasticsearch/elasticsearch:7.9.1","imagePullPolicy":"IfNotPresent","name":"sysctl-init","resources":{"limits":{"cpu":"1","memory":"512Mi"},"requests":{"cpu":"100m","memory":"512Mi"}},"securityContext":{"privileged":true,"runAsUser":0},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount","name":"default-token-bcrnx","readOnly":true}]},{"command":["sh","-c","bin/elasticsearch-plugin install --batch repository-s3"],"image":"docker.elastic.co/elasticsearch/elasticsearch:7.9.1","imagePullPolicy":"IfNotPresent","name":"plugins-install","resources":{"limits":{"cpu":"1","memory":"512Mi"},"requests":{"cpu":"100m","memory":"512Mi"}},"securityContext":{"privileged":true,"runAsUser":0},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/usr/share/elasticsearch/plugins","name":"plugin-volume"},{"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount","name":"default-token-bcrnx","readOnly":true}]}],"nodeName":"ip-172-31-42-37.ap-south-1.compute.internal","priority":0,"restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{"fsGroup":1000,"runAsUser":1000},"serviceAccount":"default","serviceAccountName":"default","subdomain":"es-svc-data-headless","terminationGracePeriodSeconds":30,"tolerations":[{"effect":"NoExecute","key":"node.kubernetes.io/not-ready","operator":"Exists","tolerationSeconds":300},{"effect":"NoExecute","key":"node.kubernetes.io/unreachable","operator":"Exists","tolerationSeconds":300}],"volumes":[{"name":"es-svc-data","persistentVolumeClaim":{"claimName":"es-svc-data-es-svc-data-1"}},{"emptyDir":{},"name":"plugin-volume"},{"name":"default-token-bcrnx","secret":{"defaultMode":420,"secretName":"default-token-bcrnx"}}]},"status":{"conditions":[{"lastProbeTime":null,"lastTransitionTime":"2021-12-19T10:17:14Z","status":"True","type":"Initialized"},{"lastProbeTime":null,"lastTransitionTime":"2021-12-19T10:19:27Z","status":"True","type":"Ready"},{"lastProbeTime":null,"lastTransitionTime":"2021-12-19T10:19:27Z","status":"True","type":"ContainersReady"},{"lastProbeTime":null,"lastTransitionTime":"2021-12-19T10:16:20Z","status":"True","type":"PodScheduled"}],"containerStatuses":[{"containerID":"docker://fdce3c1fbf90975bb09fa8c6780f8027befaa261f87581d755e199d77d11c233","image":"docker.elastic.co/elasticsearch/elasticsearch:7.9.1","imageID":"docker-pullable://docker.elastic.co/elasticsearch/elasticsearch@sha256:0a5308431aee029636858a6efe07e409fa699b02549a78d7904eb931b8c46920","lastState":{},"name":"elastic","ready":true,"restartCount":0,"started":true,"state":{"running":{"startedAt":"2021-12-19T10:17:14Z"}}}],"hostIP":"172.31.42.37","initContainerStatuses":[{"containerID":"docker://32c64b86e014c7309d0a4274e9361956ee44225bffc606a9c1a2c84922bf1458","image":"docker.elastic.co/elasticsearch/elasticsearch:7.9.1","imageID":"docker-pullable://docker.elastic.co/elasticsearch/elasticsearch@sha256:0a5308431aee029636858a6efe07e409fa699b02549a78d7904eb931b8c46920","lastState":{},"name":"sysctl-init","ready":true,"restartCount":0,"state":{"terminated":{"containerID":"docker://32c64b86e014c7309d0a4274e9361956ee44225bffc606a9c1a2c84922bf1458","exitCode":0,"finishedAt":"2021-12-19T10:16:58Z","reason":"Completed","startedAt":"2021-12-19T10:16:58Z"}}},{"containerID":"docker://3f0be58f8b31dccc45a46209c0599114ffd16bccfa06e4d4abd97f7806666108","image":"docker.elastic.co/elasticsearch/elasticsearch:7.9.1","imageID":"docker-pullable://docker.elastic.co/elasticsearch/elasticsearch@sha256:0a5308431aee029636858a6efe07e409fa699b02549a78d7904eb931b8c46920","lastState":{},"name":"plugins-install","ready":true,"restartCount":0,"state":{"terminated":{"containerID":"docker://3f0be58f8b31dccc45a46209c0599114ffd16bccfa06e4d4abd97f7806666108","exitCode":0,"finishedAt":"2021-12-19T10:17:13Z","reason":"Completed","startedAt":"2021-12-19T10:16:59Z"}}}],"phase":"Running","podIP":"172.31.44.28","podIPs":[{"ip":"172.31.44.28"}],"qosClass":"Burstable","startTime":"2021-12-19T10:16:20Z"}}