{"apiVersion":"v1","kind":"Pod","metadata":{"annotations":{"kubernetes.io/limit-ranger":"LimitRanger plugin set: cpu, memory request for init container sysctl-init; cpu, memory limit for init container sysctl-init; cpu, memory request for init container plugins-install; cpu, memory limit for init container plugins-install","kubernetes.io/psp":"eks.privileged"},"creationTimestamp":"2021-12-19T10:19:32Z","generateName":"es-svc-data-","labels":{"app":"es-svc-data","controller-revision-hash":"es-svc-data-869d9dbb56","logging.opstreelabs.in":"true","logging.opstreelabs.in/kind":"Elasticsearch","role":"data","statefulset.kubernetes.io/pod-name":"es-svc-data-0"},"name":"es-svc-data-0","namespace":"staging","ownerReferences":[{"apiVersion":"apps/v1","blockOwnerDeletion":true,"controller":true,"kind":"StatefulSet","name":"es-svc-data","uid":"6477bc54-78be-45e7-b521-d7077ef43b12"}],"resourceVersion":"236679265","selfLink":"/api/v1/namespaces/staging/pods/es-svc-data-0","uid":"ea5011d7-6a4b-4734-953b-8d4c8f0788b2"},"spec":{"affinity":{"podAntiAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":[{"labelSelector":{"matchExpressions":[{"key":"app","operator":"In","values":["elasticsearch-cluster-data"]}]},"topologyKey":"kubernetes.io/hostname"}]}},"containers":[{"env":[{"name":"ES_JAVA_OPTS","value":"-Xmx1g -Xms1g"},{"name":"SCHEME","value":"http"},{"name":"cluster.name","value":"dev"},{"name":"discovery.seed_hosts","value":"es-svc-master-headless"},{"name":"network.host","value":"0.0.0.0"},{"name":"node.data","value":"true"},{"name":"node.ingest","value":"false"},{"name":"node.master","value":"false"},{"name":"node.name","valueFrom":{"fieldRef":{"apiVersion":"v1","fieldPath":"metadata.name"}}}],"image":"docker.elastic.co/elasticsearch/elasticsearch:7.9.1","imagePullPolicy":"IfNotPresent","name":"elastic","readinessProbe":{"exec":{"command":["sh","-c","#!/usr/bin/env bash -e\nSTART_FILE=/tmp/.es_start_file\n\nhttp () {\n  local path=\"${1}\"\n  local args=\"${2}\"\n  set -- -XGET -s\n\n  if [ \"$args\" != \"\" ]; then\n    set -- \"$@\" $args\n  fi\n\n  if [ -n \"${ELASTIC_USERNAME}\" ] \u0026\u0026 [ -n \"${ELASTIC_PASSWORD}\" ]; then\n    set -- \"$@\" -u \"${ELASTIC_USERNAME}:${ELASTIC_PASSWORD}\"\n  fi\n\n  curl --output /dev/null -k \"$@\" \"${SCHEME}://127.0.0.1:9200${path}\"\n}\n\nif [ -f \"${START_FILE}\" ]; then\n  echo 'Elasticsearch is already running, lets check the node is healthy'\n  HTTP_CODE=$(http \"/\" \"-w %{http_code}\")\n  RC=$?\n  if [[ ${RC} -ne 0 ]]; then\n    echo \"curl --output /dev/null -k -XGET -s -w '%{http_code}' \\${BASIC_AUTH} ${SCHEME}://127.0.0.1:9200/ failed with RC ${RC}\"\n    exit ${RC}\n  fi\n  # ready if HTTP code 200, 503 is tolerable if ES version is 6.x\n  if [[ ${HTTP_CODE} == \"200\" ]]; then\n    exit 0\n  elif [[ ${HTTP_CODE} == \"503\" \u0026\u0026 \"7\" == \"6\" ]]; then\n    exit 0\n  else\n    echo \"curl --output /dev/null -k -XGET -s -w '%{http_code}' \\${BASIC_AUTH} ${SCHEME}://127.0.0.1:9200/ failed with HTTP code ${HTTP_CODE}\"\n    exit 1\n  fi\n\nelse\n  echo 'Waiting for elasticsearch cluster to become ready (request params: \"wait_for_status=green\u0026timeout=1s\" )'\n  if http \"/_cluster/health?wait_for_status=green\u0026timeout=1s\" \"--fail\" ; then\n    touch ${START_FILE}\n    exit 0\n  else\n    echo 'Cluster is not yet ready (request params: \"wait_for_status=green\u0026timeout=1s\" )'\n    exit 1\n  fi\nfi\n"]},"failureThreshold":3,"initialDelaySeconds":10,"periodSeconds":10,"successThreshold":3,"timeoutSeconds":5},"resources":{"limits":{"cpu":"500m","memory":"2Gi"},"requests":{"cpu":"500m","memory":"2Gi"}},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/usr/share/elasticsearch/data","name":"es-svc-data"},{"mountPath":"/usr/share/elasticsearch/plugins","name":"plugin-volume"},{"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount","name":"default-token-bcrnx","readOnly":true}]}],"dnsPolicy":"ClusterFirst","enableServiceLinks":true,"hostname":"es-svc-data-0","initContainers":[{"command":["sysctl","-w","vm.max_map_count=262144"],"image":"docker.elastic.co/elasticsearch/elasticsearch:7.9.1","imagePullPolicy":"IfNotPresent","name":"sysctl-init","resources":{"limits":{"cpu":"1","memory":"512Mi"},"requests":{"cpu":"100m","memory":"512Mi"}},"securityContext":{"privileged":true,"runAsUser":0},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount","name":"default-token-bcrnx","readOnly":true}]},{"command":["sh","-c","bin/elasticsearch-plugin install --batch repository-s3"],"image":"docker.elastic.co/elasticsearch/elasticsearch:7.9.1","imagePullPolicy":"IfNotPresent","name":"plugins-install","resources":{"limits":{"cpu":"1","memory":"512Mi"},"requests":{"cpu":"100m","memory":"512Mi"}},"securityContext":{"privileged":true,"runAsUser":0},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/usr/share/elasticsearch/plugins","name":"plugin-volume"},{"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount","name":"default-token-bcrnx","readOnly":true}]}],"nodeName":"ip-172-31-15-9.ap-south-1.compute.internal","priority":0,"restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{"fsGroup":1000,"runAsUser":1000},"serviceAccount":"default","serviceAccountName":"default","subdomain":"es-svc-data-headless","terminationGracePeriodSeconds":30,"tolerations":[{"effect":"NoExecute","key":"node.kubernetes.io/not-ready","operator":"Exists","tolerationSeconds":300},{"effect":"NoExecute","key":"node.kubernetes.io/unreachable","operator":"Exists","tolerationSeconds":300}],"volumes":[{"name":"es-svc-data","persistentVolumeClaim":{"claimName":"es-svc-data-es-svc-data-0"}},{"emptyDir":{},"name":"plugin-volume"},{"name":"default-token-bcrnx","secret":{"defaultMode":420,"secretName":"default-token-bcrnx"}}]},"status":{"conditions":[{"lastProbeTime":null,"lastTransitionTime":"2021-12-19T10:19:55Z","status":"True","type":"Initialized"},{"lastProbeTime":null,"lastTransitionTime":"2021-12-19T10:21:51Z","status":"True","type":"Ready"},{"lastProbeTime":null,"lastTransitionTime":"2021-12-19T10:21:51Z","status":"True","type":"ContainersReady"},{"lastProbeTime":null,"lastTransitionTime":"2021-12-19T10:19:32Z","status":"True","type":"PodScheduled"}],"containerStatuses":[{"containerID":"docker://43c4d2b755a5b9bae333990b316172a6db6e71b039b3f2cc598b9ef8e6589385","image":"docker.elastic.co/elasticsearch/elasticsearch:7.9.1","imageID":"docker-pullable://docker.elastic.co/elasticsearch/elasticsearch@sha256:0a5308431aee029636858a6efe07e409fa699b02549a78d7904eb931b8c46920","lastState":{},"name":"elastic","ready":true,"restartCount":0,"started":true,"state":{"running":{"startedAt":"2021-12-19T10:19:56Z"}}}],"hostIP":"172.31.15.9","initContainerStatuses":[{"containerID":"docker://5208c5942d11bb7f68a4374a2e1e618ba2171bc34cf7f12e5888117fba53b346","image":"docker.elastic.co/elasticsearch/elasticsearch:7.9.1","imageID":"docker-pullable://docker.elastic.co/elasticsearch/elasticsearch@sha256:0a5308431aee029636858a6efe07e409fa699b02549a78d7904eb931b8c46920","lastState":{},"name":"sysctl-init","ready":true,"restartCount":0,"state":{"terminated":{"containerID":"docker://5208c5942d11bb7f68a4374a2e1e618ba2171bc34cf7f12e5888117fba53b346","exitCode":0,"finishedAt":"2021-12-19T10:19:42Z","reason":"Completed","startedAt":"2021-12-19T10:19:42Z"}}},{"containerID":"docker://c52353083c04b975a9a560a48a6a73c1a9b0498dc3b54a3f96784a9eb9776901","image":"docker.elastic.co/elasticsearch/elasticsearch:7.9.1","imageID":"docker-pullable://docker.elastic.co/elasticsearch/elasticsearch@sha256:0a5308431aee029636858a6efe07e409fa699b02549a78d7904eb931b8c46920","lastState":{},"name":"plugins-install","ready":true,"restartCount":0,"state":{"terminated":{"containerID":"docker://c52353083c04b975a9a560a48a6a73c1a9b0498dc3b54a3f96784a9eb9776901","exitCode":0,"finishedAt":"2021-12-19T10:19:55Z","reason":"Completed","startedAt":"2021-12-19T10:19:42Z"}}}],"phase":"Running","podIP":"172.31.14.168","podIPs":[{"ip":"172.31.14.168"}],"qosClass":"Burstable","startTime":"2021-12-19T10:19:32Z"}}